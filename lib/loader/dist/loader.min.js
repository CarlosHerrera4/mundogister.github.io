/*!
 * Loader v0.1.1
 * https://github.com/fengyuanchen/loader
 *
 * Copyright (c) 2015 Fengyuan Chen
 * Released under the MIT license
 *
 * Date: 2015-12-25T06:57:42.553Z
 */
!function(t,e){"object"==typeof module&&"object"==typeof module.exports?module.exports=e(t,!0):e(t)}("undefined"!=typeof window?window:this,function(t,e){"use strict";function n(t){return M.call(t).slice(8,-1).toLowerCase()}function i(t){return"number"==typeof t&&!isNaN(t)}function r(t){return"object"==typeof t&&null!==t}function a(t){var e,n;if(!r(t))return!1;try{return e=t.constructor,n=e.prototype,e&&n&&N.call(n,"isPrototypeOf")}catch(i){return!1}}function o(t){return"function"===n(t)}function s(t){return Array.isArray?Array.isArray(t):"array"===n(t)}function c(t,e){var n=[];return e=e>=0?e:0,Array.from?Array.from(t).slice(e):n.slice.call(t,e)}function h(t,e){var n,a;if(t&&o(e))if(s(t)||i(t.length))for(a=0,n=t.length;n>a&&e.call(t,t[a],a,t)!==!1;a++);else if(r(t))for(a in t)if(t.hasOwnProperty(a)&&e.call(t,t[a],a,t)===!1)break;return t}function u(t){var e;if(arguments.length>1){if(e=c(arguments),Object.assign)return Object.assign.apply(Object,e);e.shift(),h(e,function(e){h(e,function(e,n){t[n]=e})})}return t}function f(t,e){var n=c(arguments,2);return function(){return t.apply(e,n.concat(c(arguments)))}}function d(t,e,n){var i="",r=e;for(n+=e;n>r;r++)i+=F(t.getUint8(r));return i}function g(t){var e,n=t.replace(b,""),i=atob(n),r=i.length,a=new y(r),o=new Uint8Array(a);for(e=0;r>e;e++)o[e]=i.charCodeAt(e);return a}function l(t){var e,n=new Uint8Array(t),i=n.length,r="";for(e=0;i>e;e++)r+=F(n[e]);return"data:image/jpeg;base64,"+btoa(r)}function m(t){var e=new Image;return e.src=t,e}function p(t){var e=O(t.degree)%180,n=(e>90?180-e:e)*A/180,i=j(n),r=k(n),a=t.width,o=t.height;return{width:a*r+o*i,height:a*i+o*r}}function w(t,e){this.image=t,this.options=u({},w.DEFAULTS,a(e)&&e),this.data=null,this.init()}var y=t.ArrayBuffer,v=/^data\:/,b=/^data\:([^\;]+)\;base64,/,U=/^data\:image\/jpeg.*;base64,/,A=Math.PI,L=Math.min,x=Math.max,j=Math.sin,k=Math.cos,O=Math.abs,C=Math.floor,E=Object.prototype,M=E.toString,N=E.hasOwnProperty,F=String.fromCharCode;w.prototype={constructor:w,init:function(){var t,e,n=this,i=this.image;if(!i||"img"!==i.tagName.toLowerCase()||!i.src)throw new Error("The given image is not a valid image");return y?(e=i.src,v.test(e)?U.test(e)?this.read(g(e)):this.load(i):(t=new XMLHttpRequest,t.onerror=t.onabort=function(){n.load(i)},t.onload=function(){n.read(this.response)},t.open("get",e),t.responseType="arraybuffer",void t.send())):this.load(i)},read:function(t){var e=this.readOrientation(t);e>1?(this.translate(e),this.load(m(l(t)))):this.load(this.image)},readOrientation:function(t){var e,n,i,r,a,o,s,c,h,u,f=new DataView(t),g=f.byteLength;if(255===f.getUint8(0)&&216===f.getUint8(1))for(h=2;g>h;){if(255===f.getUint8(h)&&225===f.getUint8(h+1)){s=h;break}h++}if(s&&(n=s+4,i=s+10,"Exif"===d(f,n,4)&&(o=f.getUint16(i),a=18761===o,(a||19789===o)&&42===f.getUint16(i+2,a)&&(r=f.getUint32(i+4,a),r>=8&&(c=i+r)))),c)for(g=f.getUint16(c,a),u=0;g>u;u++)if(h=c+12*u+2,274===f.getUint16(h,a)){e=f.getUint16(h+8,a),f.setUint16(h+8,1,a);break}return e},translate:function(t){var e=0,n=1,i=1;switch(t){case 2:n=-1;break;case 3:e=-180;break;case 4:i=-1;break;case 5:e=90,i=-1;break;case 6:e=90;break;case 7:e=90,n=-1;break;case 8:e=-90}this.data={rotate:e,scaleX:n,scaleY:i}},load:function(t){var e=f(function(){t.removeEventListener("load",e,!1),this.resize(t)},this);t.complete?this.resize(t):t.addEventListener("load",e,!1)},draw:function(t){var e,n,r,a=document.createElement("canvas"),o=a.getContext("2d"),s=this.data,c=0,h=0,u=t.naturalWidth,f=t.naturalHeight,d=s&&s.rotate,g=s&&s.scaleX,l=s&&s.scaleY,m=i(g)&&i(l)&&(1!==g||1!==l),w=i(d)&&0!==d,y=w||m,v=u,b=f;return m&&(e=u/2,n=f/2),w&&(r=p({width:u,height:f,degree:d}),v=r.width,b=r.height,e=r.width/2,n=r.height/2),a.width=v,a.height=b,y&&(c=-u/2,h=-f/2,o.save(),o.translate(e,n)),w&&o.rotate(d*A/180),m&&o.scale(g,l),o.drawImage(t,C(c),C(h),C(u),C(f)),y&&o.restore(),a},resize:function(t){var e=this.options,n=this.draw(t),r=n.width,a=n.height,o=r/a,s=document.createElement("canvas"),c=x(0,e.minWidth)||0,h=x(0,e.minHeight)||0,u=x(c,e.maxWidth)||1/0,f=x(h,e.maxHeight)||1/0,d=O(e.width)||r,g=O(e.height)||a;c>0&&isFinite(c)?h=c/o:h>0&&isFinite(h)&&(c=h*o),u>0&&isFinite(u)?f=u/o:f>0&&isFinite(f)&&(u=f*o),d=L(x(d,c),u),g=L(x(g,h),f),i(d)&&i(g)?g*o>d?g=d/o:d=g*o:(d=r,g=a),s.width=d,s.height=g,s.getContext("2d").drawImage(n,0,0,C(r),C(a),0,0,C(d),C(g)),this.done(s)},done:function(t){var e=this.options,n=t;"image"===e.type&&(n=m(t.toDataURL())),o(e.done)&&e.done.call(this,n)}},w.DEFAULTS={type:"image",width:NaN,height:NaN,minWidth:0,minHeight:0,maxWidth:1/0,maxHeight:1/0,done:null};var H=t.Loader;return w.noConflict=function(){return t.Loader=H,w},"function"==typeof define&&define.amd&&define("loader",[],function(){return w}),"undefined"==typeof e&&(t.Loader=w),w});